<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduTrack Pro - Semester & Grade Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(8px); border: 1px solid rgba(226, 232, 240, 0.8); }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-[#f0f2f5] text-slate-900 min-h-screen">

    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- Sidebar Navigation -->
        <aside class="w-full md:w-80 bg-white border-r border-slate-200 flex flex-col p-6 sticky top-0 h-auto md:h-screen z-30">
            <div class="flex items-center gap-3 mb-10 px-2">
                <div class="bg-indigo-600 p-2.5 rounded-2xl text-white shadow-lg shadow-indigo-100">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
                </div>
                <h1 class="font-extrabold text-2xl tracking-tight">EduTrack <span class="text-indigo-600">Pro</span></h1>
            </div>

            <nav class="space-y-2 flex-1">
                <button onclick="switchTab('dashboard')" id="nav-dashboard" class="nav-btn w-full flex items-center gap-4 px-5 py-4 rounded-2xl transition-all font-bold text-slate-500 hover:bg-slate-50">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/></svg>
                    Dashboard
                </button>
                <button onclick="switchTab('semester')" id="nav-semester" class="nav-btn w-full flex items-center gap-4 px-5 py-4 rounded-2xl transition-all font-bold text-slate-500 hover:bg-slate-50">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1-2.5-2.5z"/><path d="M8 7h6"/><path d="M8 11h8"/></svg>
                    Semester Manager
                </button>
                <button onclick="switchTab('grades')" id="nav-grades" class="nav-btn w-full flex items-center gap-4 px-5 py-4 rounded-2xl transition-all font-bold text-slate-500 hover:bg-slate-50">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                    Grade Tracker
                </button>
            </nav>

            <div class="mt-auto space-y-3 pt-6 border-t">
                <button onclick="exportFullReport()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-2 hover:bg-black transition-all">
                    Download Full Report
                </button>
                <p class="text-[10px] text-center text-slate-400 font-bold uppercase tracking-widest">Auto-saved to Local Storage</p>
            </div>
        </aside>

        <!-- Main Workspace -->
        <main class="flex-1 p-6 md:p-10 lg:p-16 overflow-y-auto">
            
            <!-- Dashboard View -->
            <div id="tab-dashboard" class="tab-content space-y-10">
                <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                    <div>
                        <h2 class="text-4xl font-extrabold tracking-tight">Academic Overview</h2>
                        <p class="text-slate-500 font-medium mt-1">Real-time GPA across all semesters.</p>
                    </div>
                    <div class="flex gap-4">
                        <div class="glass-card px-8 py-6 rounded-[2rem] text-center shadow-sm">
                            <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Cumulative GPA</p>
                            <span id="cum-gpa" class="text-4xl font-black text-indigo-600">0.00</span>
                        </div>
                    </div>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8" id="semester-summary-grid">
                    <!-- Dynamic Summary Cards -->
                </div>
            </div>

            <!-- Semester Manager -->
            <div id="tab-semester" class="tab-content space-y-8">
                <div class="flex justify-between items-center">
                    <h2 class="text-3xl font-extrabold">Semester Organization</h2>
                    <button onclick="addSemester()" class="bg-indigo-600 text-white px-6 py-3 rounded-2xl font-bold hover:bg-indigo-700 shadow-lg shadow-indigo-100">+ New Semester</button>
                </div>
                <div id="semester-list" class="space-y-10">
                    <!-- Semester blocks -->
                </div>
            </div>

            <!-- Grade Tracker (Sheet logic) -->
            <div id="tab-grades" class="tab-content space-y-8">
                <h2 class="text-3xl font-extrabold">Advanced Grade Tracker</h2>
                <div id="grade-config-container" class="space-y-12">
                    <!-- Per-course weight configuration and assignment entry -->
                </div>
            </div>

        </main>
    </div>

    <!-- UI Templates (Hidden) -->
    <template id="temp-semester">
        <div class="semester-block space-y-6">
            <div class="flex items-center gap-4 bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100">
                <input type="text" class="semester-name text-xl font-bold flex-1 bg-transparent border-none outline-none focus:ring-0" placeholder="e.g. Fall 2024">
                <div class="text-right px-6 border-x">
                    <p class="text-[10px] font-bold text-slate-400 uppercase">Semester GPA</p>
                    <p class="sem-gpa text-lg font-black text-indigo-600">0.00</p>
                </div>
                <button class="delete-sem text-slate-300 hover:text-red-500">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                </button>
            </div>
            <div class="course-pill-container flex flex-wrap gap-4">
                <!-- Courses in this semester -->
                <button class="add-course-btn px-6 py-3 rounded-2xl border-2 border-dashed border-slate-200 text-slate-400 font-bold hover:border-indigo-300 hover:text-indigo-400 transition-all">+ Add Course</button>
            </div>
        </div>
    </template>

    <script>
        // --- DATA MODEL ---
        let appState = JSON.parse(localStorage.getItem('eduTrack_v2')) || {
            semesters: [
                { id: '1', name: 'Semester 1', courses: [] }
            ],
            assignments: [],
            config: {
                gradingScale: { A: 90, B: 80, C: 70, D: 60 }
            }
        };

        function save() {
            localStorage.setItem('eduTrack_v2', JSON.stringify(appState));
            render();
        }

        // --- SEMESTER ACTIONS ---
        function addSemester() {
            appState.semesters.push({ id: Date.now().toString(), name: 'New Semester', courses: [] });
            save();
        }

        function deleteSemester(id) {
            appState.semesters = appState.semesters.filter(s => s.id !== id);
            save();
        }

        function addCourse(semId) {
            const sem = appState.semesters.find(s => s.id === semId);
            const courseId = 'c-' + Date.now();
            sem.courses.push({
                id: courseId,
                name: 'New Class',
                credits: 3,
                color: '#'+Math.floor(Math.random()*16777215).toString(16),
                weights: [
                    { id: 'w1', name: 'Homework', percent: 20 },
                    { id: 'w2', name: 'Exams', percent: 80 }
                ]
            });
            save();
        }

        // --- GRADE CALCULATION (SHEET LOGIC) ---
        function calculateCourseGrade(course) {
            const courseTasks = appState.assignments.filter(a => a.courseId === course.id && a.score !== null);
            if (courseTasks.length === 0) return 0;

            let totalWeightedGrade = 0;
            let totalWeightsAvailable = 0;

            course.weights.forEach(cat => {
                const catTasks = courseTasks.filter(a => a.category === cat.name);
                if (catTasks.length > 0) {
                    const avg = catTasks.reduce((sum, t) => sum + (t.score / t.total), 0) / catTasks.length;
                    totalWeightedGrade += avg * cat.percent;
                    totalWeightsAvailable += cat.percent;
                }
            });

            return totalWeightsAvailable > 0 ? (totalWeightedGrade / totalWeightsAvailable) * 100 : 0;
        }

        function getGradePoint(percent) {
            if (percent >= 90) return 4.0;
            if (percent >= 80) return 3.0;
            if (percent >= 70) return 2.0;
            if (percent >= 60) return 1.0;
            return 0.0;
        }

        function calculateSemesterGPA(semId) {
            const sem = appState.semesters.find(s => s.id === semId);
            if (!sem || sem.courses.length === 0) return 0;
            
            let totalPoints = 0;
            let totalCredits = 0;

            sem.courses.forEach(c => {
                const grade = calculateCourseGrade(c);
                totalPoints += getGradePoint(grade) * c.credits;
                totalCredits += c.credits;
            });

            return totalCredits > 0 ? (totalPoints / totalCredits).toFixed(2) : "0.00";
        }

        // --- UI RENDERING ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(b => {
                b.classList.remove('bg-indigo-600', 'text-white', 'shadow-lg', 'shadow-indigo-100');
                b.classList.add('text-slate-500');
            });
            document.getElementById('nav-' + tabId).classList.add('bg-indigo-600', 'text-white', 'shadow-lg', 'shadow-indigo-100');
            document.getElementById('nav-' + tabId).classList.remove('text-slate-500');
        }

        function render() {
            renderDashboard();
            renderSemesters();
            renderGradeTracker();
        }

        function renderDashboard() {
            const container = document.getElementById('semester-summary-grid');
            container.innerHTML = appState.semesters.map(s => `
                <div class="glass-card p-8 rounded-[2.5rem] shadow-sm flex justify-between items-center">
                    <div>
                        <h3 class="text-xl font-bold text-slate-800">${s.name}</h3>
                        <p class="text-sm text-slate-400 font-medium">${s.courses.length} Courses Enrolled</p>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">GPA</p>
                        <p class="text-3xl font-black text-indigo-600">${calculateSemesterGPA(s.id)}</p>
                    </div>
                </div>
            `).join('');

            // Global GPA
            const totalPoints = appState.semesters.reduce((acc, s) => acc + parseFloat(calculateSemesterGPA(s.id)), 0);
            document.getElementById('cum-gpa').innerText = appState.semesters.length > 0 ? (totalPoints / appState.semesters.length).toFixed(2) : "0.00";
        }

        function renderSemesters() {
            const container = document.getElementById('semester-list');
            container.innerHTML = '';
            
            appState.semesters.forEach(sem => {
                const clone = document.getElementById('temp-semester').content.cloneNode(true);
                clone.querySelector('.semester-name').value = sem.name;
                clone.querySelector('.semester-name').onchange = (e) => { sem.name = e.target.value; save(); };
                clone.querySelector('.delete-sem').onclick = () => deleteSemester(sem.id);
                clone.querySelector('.sem-gpa').innerText = calculateSemesterGPA(sem.id);
                
                const pillBox = clone.querySelector('.course-pill-container');
                sem.courses.forEach(c => {
                    const pill = document.createElement('div');
                    pill.className = "group relative bg-white px-6 py-4 rounded-2xl border-2 border-slate-50 flex items-center gap-4 shadow-sm";
                    pill.innerHTML = `
                        <div class="w-3 h-3 rounded-full" style="background-color: ${c.color}"></div>
                        <div>
                            <input value="${c.name}" class="font-bold text-sm bg-transparent outline-none border-none p-0 w-24" onchange="updateCourseName('${c.id}', this.value)">
                            <div class="flex items-center gap-2 text-[10px] font-bold text-slate-400 uppercase">
                                <input type="number" value="${c.credits}" class="w-4 bg-transparent outline-none" onchange="updateCourseCredits('${c.id}', this.value)"> Credits
                            </div>
                        </div>
                        <button onclick="deleteCourse('${sem.id}', '${c.id}')" class="opacity-0 group-hover:opacity-100 transition-opacity text-slate-300 hover:text-red-500">
                            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                        </button>
                    `;
                    pillBox.insertBefore(pill, pillBox.lastElementChild);
                });
                
                pillBox.lastElementChild.onclick = () => addCourse(sem.id);
                container.appendChild(clone);
            });
        }

        function renderGradeTracker() {
            const container = document.getElementById('grade-config-container');
            const allCourses = appState.semesters.flatMap(s => s.courses);
            
            container.innerHTML = allCourses.map(c => `
                <div class="bg-white rounded-[2.5rem] border border-slate-100 shadow-sm overflow-hidden">
                    <div class="p-8 border-b bg-slate-50/50 flex justify-between items-center">
                        <div>
                            <h3 class="text-2xl font-extrabold text-slate-800">${c.name}</h3>
                            <p class="text-sm text-slate-400 font-bold uppercase tracking-tighter">Current Weighted Grade: ${calculateCourseGrade(c).toFixed(1)}%</p>
                        </div>
                        <div class="flex gap-2">
                             <button onclick="addAssignment('${c.id}')" class="bg-indigo-600 text-white px-5 py-2 rounded-xl text-sm font-bold">+ New Entry</button>
                        </div>
                    </div>
                    
                    <div class="p-8 grid grid-cols-1 md:grid-cols-4 gap-8">
                        <!-- Weights Config -->
                        <div class="md:col-span-1 space-y-4">
                            <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Weight Distribution</h4>
                            ${c.weights.map((w, idx) => `
                                <div class="flex items-center gap-2">
                                    <input value="${w.name}" class="flex-1 text-xs font-bold p-2 bg-slate-50 rounded-lg outline-none" onchange="updateWeight('${c.id}', ${idx}, 'name', this.value)">
                                    <input type="number" value="${w.percent}" class="w-12 text-xs text-center font-bold p-2 bg-slate-50 rounded-lg outline-none" onchange="updateWeight('${c.id}', ${idx}, 'percent', this.value)">
                                    <span class="text-[10px] font-bold text-slate-300">%</span>
                                </div>
                            `).join('')}
                        </div>

                        <!-- Assignments Table -->
                        <div class="md:col-span-3">
                             <table class="w-full text-left">
                                <thead class="text-[10px] font-black text-slate-400 uppercase">
                                    <tr>
                                        <th class="pb-4">Task Name</th>
                                        <th class="pb-4">Category</th>
                                        <th class="pb-4">Score</th>
                                        <th class="pb-4">Total</th>
                                        <th class="pb-4"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${appState.assignments.filter(a => a.courseId === c.id).map(a => `
                                        <tr class="border-t border-slate-50">
                                            <td class="py-3"><input value="${a.title}" class="text-sm font-medium bg-transparent outline-none" onchange="updateTask('${a.id}', 'title', this.value)"></td>
                                            <td class="py-3">
                                                <select class="text-xs font-bold bg-slate-50 p-1 rounded outline-none" onchange="updateTask('${a.id}', 'category', this.value)">
                                                    ${c.weights.map(w => `<option ${a.category === w.name ? 'selected' : ''}>${w.name}</option>`).join('')}
                                                </select>
                                            </td>
                                            <td class="py-3"><input type="number" value="${a.score}" class="w-12 text-xs font-bold bg-slate-50 p-1 rounded text-center outline-none" onchange="updateTask('${a.id}', 'score', parseFloat(this.value))"></td>
                                            <td class="py-3"><input type="number" value="${a.total}" class="w-12 text-xs font-bold bg-slate-50 p-1 rounded text-center outline-none" onchange="updateTask('${a.id}', 'total', parseFloat(this.value))"></td>
                                            <td class="py-3 text-right">
                                                <button onclick="deleteTask('${a.id}')" class="text-slate-300 hover:text-red-500"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                             </table>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // --- UPDATER HELPERS ---
        window.updateCourseName = (id, val) => {
            appState.semesters.forEach(s => s.courses.forEach(c => { if(c.id === id) c.name = val; }));
            save();
        };

        window.updateCourseCredits = (id, val) => {
            appState.semesters.forEach(s => s.courses.forEach(c => { if(c.id === id) c.credits = parseInt(val); }));
            save();
        };

        window.deleteCourse = (semId, courseId) => {
            const sem = appState.semesters.find(s => s.id === semId);
            sem.courses = sem.courses.filter(c => c.id !== courseId);
            appState.assignments = appState.assignments.filter(a => a.courseId !== courseId);
            save();
        };

        window.updateWeight = (courseId, idx, field, val) => {
            appState.semesters.forEach(s => s.courses.forEach(c => { 
                if(c.id === courseId) {
                    c.weights[idx][field] = field === 'percent' ? parseInt(val) : val;
                }
            }));
            save();
        };

        window.addAssignment = (courseId) => {
            const allCourses = appState.semesters.flatMap(s => s.courses);
            const course = allCourses.find(c => c.id === courseId);
            appState.assignments.push({
                id: Date.now().toString(),
                courseId,
                title: 'New Task',
                category: course.weights[0].name,
                score: 0,
                total: 100,
                completed: true
            });
            save();
        };

        window.updateTask = (id, field, val) => {
            const task = appState.assignments.find(a => a.id === id);
            if (task) task[field] = val;
            save();
        };

        window.deleteTask = (id) => {
            appState.assignments = appState.assignments.filter(a => a.id !== id);
            save();
        };

        async function exportFullReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFontSize(22);
            doc.text("Master Academic Transcript", 14, 20);
            
            appState.semesters.forEach((sem, idx) => {
                const y = idx === 0 ? 30 : doc.lastAutoTable.finalY + 20;
                doc.setFontSize(14);
                doc.text(`${sem.name} - GPA: ${calculateSemesterGPA(sem.id)}`, 14, y);
                
                const rows = sem.courses.map(c => [
                    c.name,
                    c.credits,
                    `${calculateCourseGrade(c).toFixed(1)}%`,
                    getGradePoint(calculateCourseGrade(c)).toFixed(1)
                ]);

                doc.autoTable({
                    startY: y + 5,
                    head: [['Course', 'Credits', 'Grade %', 'Points']],
                    body: rows
                });
            });

            doc.save("EduTrack_Master_Report.pdf");
        }

        // --- INITIALIZE ---
        window.onload = () => {
            switchTab('dashboard');
            render();
        };
    </script>
</body>
</html>

